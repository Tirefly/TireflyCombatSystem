# 关于几个需要确认的问题

- 是否需要支持蓝图子类？
  - 回答：不需要，插件处于开发阶段）
- 配置方式偏好？
  - 回答：（手动列表 vs 自动扫描 vs 混合）我现在的倾向是混合比较好，项目开发发时，提供自动扫描机制，并且定期执行，保证开发者新增/删除/修改Id的DataAsset能够被编辑器检测到。这样才能方便开发者在开发时能够通过我的TireflyGameplayUtils插件中提供的UFUNCTION的元数据符号GetParamOptions机制、和UE5官方提供的UPARAM元数据符号GetOptions机制，在蓝图编辑器中以选项的方式在函数参数和变量赋值时通过下拉菜单选择：
    - 属性名（当然，属性的唯一标识除了FName类型的属性名作为PrimaryDataAssetId，还有GameplayTag，只需要扩展相应的以GameplayTag查询/操作的函数即可）
    - 状态名（状态的唯一标识目前仍然只有FName类型的状态名作为PrimaryDataAssetId，之后可能也会扩展GameplayTag绑定）
    - 状态槽名（当然，状态槽的唯一标识除了FName类型的状态槽名作为PrimaryDataAssetId，还有GameplayTag，只需要扩展相应的以GameplayTag查询/操作的函数即可）
- 是否需要过渡期双重支持？
  - 回答：不需要，仅保留DataAsset即可
- Modifier 定义是否也迁移？（AttributeModifierDef、SkillModifierDef）
  - 回答：这个我还不确定，我想听听你的建议

<br/>

# 一些补充内容和思考

- 新的 AttributeDef、StateDef、StateSlotDef 一定要使用 UPrimaryDataAsset 作为基类，并重写函数 GetPrimaryAssetId。函数 GetPrimaryAssetId 需要两个参数，一个是 PrimaryAssetType，一个是 PrimaryAssetId。
  - PrimaryAssetType 应该在各自的 DefinitionAsset 的C++类中声明一个静态变量，各自的命名规范为：
    - TcsAttributeDefAsset
    - TcsStateDefAsset
    - TcsStateSlotDefAsset
  - PrimaryAssetId 可以直接使用 AttributeDefId、StateDefId、StateSlotDefId（这三个是我期望的Id变量名，现在 design.md 文档中都是 DefinitionId，太过笼统）
  - design.md 文件中提供的实现思路显示，函数 GetPrimaryAssetId 的声明和实现都在头文件，但按照我的思路，实现就应该放在 .cpp 文件了
- 我希望TCS插件中所有能够在蓝图中调用的函数、配置和操作的变量，都能够有描述精确精炼的 ToolTip，但我现在查看 design.md，很明显是缺少这部分卡考虑的，我不确定以前的开发内容是否也缺少这部分考虑。
  - 我觉得需要新建一个明确的 spec，或者更新TCS插件的 project.md 或者 AGENTS.md，作为后续 openspec 操作的硬性规范
  - 以及明确写在插件的 CLAUDE.md 中（如果插件现在没有 CLAUDE.md，那么TCS插件应该独立添加一个 CLAUDE.md）
- Attribute、StateSlot 都有对应的 GameplayTag 作为标识，State 我觉得也有必要添加，就在当前的提案中实现吧，同时也在 StateManager 中加上对应的查询函数
- 关于 TcsDeveloperSettings 的改造，我觉得现在 design.md 中的实现很不好，应该提供几种 DefAsset 的路径选择（UE应该有只针对项目内部可以在编辑器内通过鼠标点选来设置的路径变量，而不是直接使用字符串），而不是直接开放 TMap 变量让开发者手动配置（一旦 Asset数量多起来，会很离谱）。
  - 根据我上面关于配置偏好的内容，DeveloperSettings 需要缓存所有类型的 DefAssets，来方便使用 TCS 插件的开发者在编辑器中执行开发工作，但我觉得没必要把缓存结果暴露在编辑器中。
  - 还是根据我上面关于配置偏好的内容，DeveloperSettings 还需要定期检查给定路径中是否有 DefAsset 的新增/移除/Id修改，并实时更新自己的内部缓存，来保证开发者在编辑器中的使用。（也可能不需要定期检查更新，我不清楚有没有针对特定文件夹操作的事件回调机制，如果有并且方便调用，就不需要定期检查更新）
  - 基于以上关于 TcsDeveloperSettings 的改造思考，我发现一定要确定一件事，就是 TCS 插件在项目编辑器启动过程中一定要晚于项目的 UAssetManager 的初始化，或者至少要保证在项目编辑器启动之后，能够有效调用项目的 UAssetManager 来加载、查询、更新项目中指定路径下的 DefAssets
  - 当然以上都是在项目编辑器内关于 TcsDeveloperSettings 和 DefAssets 的改造思考。开发者打包项目后该如何管理 DefAssets，我觉得应该无需手动管理，只需要保证所有引用 DefAssets 的地方都使用正确的软引用和正确的事件回调，应该就可以了（当然如果我的这个思路不对，请给出你的正确建议）
- 至于 TcsDeveloperSettings 中旧的几个已经被舍弃的数据表的软引用配置变量，可以在提案开发完成的最后直接删除掉，无需保留（标记为DEPRECATED没有必要）
- 关于 ManageSubsystem 的改造，我觉得没必要保留原有的 FTcs***Definition 结构体和相关的API，全都删除并替换成针对 DefAsset 的API最好，毕竟插件现在处于开发阶段，保证API的整洁性，以及避免API的二义性很重要。当然了，所有查询获取 DefAsset 的函数虽然都应该是 BlueprintCallable，但函数签名的结尾已经要加上const标识符
- AttributeManagerSubsystem 确实很有必要在初始化的时候就加载并注册所有的 AttributeDefAssets，StateManagerSubsystem 确实也很有必要在初始化的时候就加载并注册所有的 StateSlotDefAssets。但是 StateManagerSubsystem 是否有必要在初始化的时候就加载并注册所有的 StateDefAssets，我觉得是个值得讨论和商榷的问题
- 关于迁移工具，我之前提到过，TCS插件现在完全处于开发阶段，并没有任何蓝图资产，所以不存在需要迁移的资产。所以迁移工具的设计和开发完全没有必要
